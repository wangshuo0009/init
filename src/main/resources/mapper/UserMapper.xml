<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sg.bjftviewprotect.mapper.UserMapper">
    <select id="selectAllUser" resultType="com.sg.bjftviewprotect.entity.User">
        SELECT
            u.*,
            GROUP_CONCAT(r.name) AS role_name
        FROM t_user u
            inner join t_user_role ur ON u.id = ur.user_id
            inner join t_role r ON ur.role_id = r.id
        <where>
            <if test="id != null and id != '' and id.length > 0">
                and u.id = #{id}
            </if>
            <if test="id != name and name != '' and name.length > 0">
                and u.name like concat('%',#{name},'%')
            </if>
            <if test="roleId != null and roleId != '' and roleId.length > 0">
                and exists(
                select 1 from t_user_role ur where ur.role_id = #{roleId}
                )
            </if>
        </where>
        GROUP BY u.id;
    </select>


</mapper>
